---
title: "Final project"
format: html
---

```{r}
library(tidyverse)
library(rvest)
library(here)
library(plotly)

url <- "https://www.ncaa.com/stats/basketball-women/d1/current/individual/102"

h <- read_html(url)

tab <- h |> html_nodes("table")
tab

wbb_df <- tab[[1]] |> html_table(fill = TRUE)

wbb_df
```

Variables in the dataset:

Rank: The rankings of highest points per game in descending order of the top 50 players
Name: Name of the player
Team: Name of the team the player is on
CL: Class Level (Fr., So., Jr., or Sr.)
Height: Height of the player
Position: (G - Guard, F - Forward, C - Center)
G: The number of games the player has played
FGM: Field Goals Made, the # of baskets each player has successfully scored on
3FG: 3 point field goals made by the athlete
FT: Free Throws made by the athlete
PTS: The number of total points scored by field goals per player
PPG: Average points per game scored by the player

Note: some of the players have "-" for rank, this means they have the same number of PPG as the person above them. 
The rank is only valid for PPG, all other stats are just extra included

Questions possible to explore: 
Maybe use another data set of viewership per year and see other connections for a part 2

Was Caitlin Clark the best player in the NCAA for Women's basketball in 2023-24 season?

What other girls on her team are on the top scoring list?

What is the comparison of girls on the SC team ppg stats compared to Iowa ppg stats?

Which team has the most top 50 ranked players?

Did this relate to the outcome of the national championship game?
(Iowa lost to SC)

Conclusion: Even though Iowa lost while having the best player in the nation on their team, Iowa Women's basketball made a HUGE lasting impact on women's basketball and for women's sports in general. -> Find a source with attendance records and put that in conclusion

Visualizations: 
Histogram of ppg by player - maybe add plotly to see exact ppg


Something with total points


Does height correlate with ppg: scatter plot

Let's look at the top 15 scorers by descending points per game. 

```{r}
top_15 <- wbb_df |> slice(1:20) |>
  mutate(Name = fct_reorder(Name, PPG))

score_plot <- ggplot(data = top_15, aes(x = Name,
                                        y = PPG,
                                        label = PPG)) +
  geom_point(color = "brown4") +
  geom_segment(aes(x = Name, xend = Name, y = 0, yend = PPG), color="orange") +
  coord_flip() 

ggplotly(score_plot, tooltip = "label")
```

As we can see from this plot, Caitlin Clark dominates points per game statistics within the NCAA. Although the top 15 scorers are relatively close in value, Caitlin Clark has almost a 10 point margin from the next person behind her in points. This might not seem like much, but in the world of basketball, a 10 point difference in AVERAGE points per game is incredible and she is far above the pack for this. 

```{r}
wbb_df |> filter(Team == "Iowa")
```
Which team has the most players in the top 50? (come back to this)

```{r}
#wbb_df |> group_by(Team) |>
  #mutate(count = case_when())
```

Do most made 3 pointers affect the top 15 list?

```{r}
three_pt <- wbb_df |> select(Name, `3FG`) |>
  arrange(desc(`3FG`))|>
  slice(1:15) |>
  mutate(Name = fct_reorder(Name, `3FG`))

three_plot <- ggplot(data = three_pt, aes(x = Name,
                          y = `3FG`,
                          label = `3FG`)) +
  geom_point(color = "brown4") +
  geom_segment(aes(x = Name, xend = Name, y = 0, yend = `3FG`), color="orange") +
  coord_flip()

ggplotly(three_plot, tooltip = "label")
```

Best # of players by class level?

```{r}
wbb_df |> group_by(Cl) |>
  summarize(Name)
```

After looking at best players by points per game, Caitlin Clark is the obvious top performer. This is where I want to start looking at team data between Iowa, the team Caitlin is on, and South Carolina the team that won over Iowa in the Final Game of March Madness for the championship.  


```{r}
url2 <- "https://www.espn.com/womens-college-basketball/team/stats/_/id/2294/iowa-hawkeyes"

h2 <- read_html(url2)

tab2 <- h2 |> html_nodes("table")


iowa_df <- tab2[[2]] |> html_table(fill = TRUE)

iowa_df
```

This is data from the Iowa Hawkeyes for the 2024 season, with 14 unnamed players so it is more team stats based

```{r}
url3 <- "https://www.espn.com/womens-college-basketball/team/stats/_/id/2579/south-carolina-gamecocks"

h3 <- read_html(url3)

tab3 <- h3 |> html_nodes("table")


sc_df <- tab3[[2]] |> html_table(fill = TRUE)

sc_df
```
This is data from the South Carolina Gamecocks for the 2024 season, with 12 unnamed players so it is more team stats based

The reason for different number of players is simply because Iowa had more people on the court with stats to report overall

```{r}
library(pander)

summary_iowa <- iowa_df |> 
  arrange(desc(MIN)) |>
  slice(1:10) |>
  summarize(points_avg = mean(PTS))

summary_south_carolina <- sc_df |>
  arrange(desc(MIN)) |>
  slice(1:10) |>
  summarize(points_avg = mean(PTS))

combined_summary <- bind_rows(
  mutate(summary_iowa, Team = "Iowa"),
  mutate(summary_south_carolina, Team = "South Carolina")) |>
  pander()
```

From this, we see Iowa has around 1 extra point average per game than South Carolina based on their top 10 most played players


Same thing for FG%?

... Iowa first

```{r}
summary_iowa2 <- iowa_df |> 
  arrange(desc(MIN)) |>
  slice(1:10) |>
  summarize(fg_made = mean(`FG%`))

summary_south_carolina2 <- sc_df |>
  arrange(desc(MIN)) |>
  slice(1:10) |>
  summarize(fg_made = mean(`FG%`))

combined_summary2 <- bind_rows(
  mutate(summary_iowa2, Team = "Iowa"),
  mutate(summary_south_carolina2, Team = "South Carolina")) |>
  pander()
```

As we can see by this, Iowa has a higher percent of field goals made still by the top 10 with the most minutes, by nearly 2%.


Still wokring on this and picking the right visualization

```{r}
iowa_df$Team <- "Iowa"

sc_df$Team <- "South Carolina"

combined_df <- rbind(iowa_df, sc_df)

ggplot(combined_df, aes(x = Team, y = PTS, fill = Team)) +
  geom_point(stat = "identity", position = position_dodge(width = 0.7)) +
  labs(title = "Comparison of Stats: Iowa vs. South Carolina") +
  theme_minimal() +
  theme(legend.position = "top") #+
  #scale_fill_manual(values = c("Iowa" = "blue", "South Carolina" = "red"))

```







